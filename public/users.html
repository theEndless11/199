<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Users Page</title>
</head>
<body>
    <!-- Logged-in user section -->
    <div id="logged-in-user">Loading logged-in user...</div>

    <!-- Users section -->
    <div id="users-container"></div>
<script>
// Get the logged-in user's ID from the query parameter or localStorage
const urlParams = new URLSearchParams(window.location.search);
const userId = urlParams.get('userId') || localStorage.getItem('userId');  // Fallback to localStorage if userId is not in URL

let loggedInUser = {};  // Store the logged-in user data
let allUsers = [];  // Store all users

async function fetchUsers() {
    try {
        console.log(`Fetching users for userId: ${userId}`);

        const response = await fetch(`/api/users?userId=${userId}`);  // Fetch users and logged-in user
        console.log('Response from fetchUsers:', response);

        if (!response.ok) {
            throw new Error(`Error: ${response.status} - ${response.statusText}`);
        }

        const data = await response.json();
        console.log('Fetched users data:', data);

        if (data.loggedInUser && data.allUsers) {
            loggedInUser = data.loggedInUser;  // Set logged-in user data
            allUsers = data.allUsers;  // Set all users excluding logged-in user

            displayLoggedInUser();  // Display logged-in user
            displayUsers();  // Display all users
        } else {
            console.error('Missing user data:', data);
            alert('Error fetching users data.');
        }
    } catch (error) {
        console.error('Error fetching users:', error);
        alert('An error occurred while fetching users. Please try again later.');
    }
}

// Display the logged-in user's username
function displayLoggedInUser() {
    const loggedInUserContainer = document.getElementById('logged-in-user');
    if (loggedInUserContainer) {
        loggedInUserContainer.textContent = `Logged in as: ${loggedInUser.username}`;
        console.log(`Displaying logged-in user: ${loggedInUser.username}`);
    } else {
        console.error('Element with id "logged-in-user" not found');
    }
}

// Display all users (excluding the logged-in user)
function displayUsers() {
    const usersContainer = document.getElementById('users-container');
    usersContainer.innerHTML = '';  // Clear previous data

    allUsers.forEach(user => {
        const userElement = document.createElement('div');
        userElement.classList.add('user');
        userElement.textContent = user.username;

        const addButton = document.createElement('button');
        addButton.classList.add('add-friend');
        addButton.textContent = 'Add Friend';
        addButton.onclick = () => addFriend(user);

        userElement.appendChild(addButton);
        usersContainer.appendChild(userElement);
    });
}

// Add a user to the friends section
function addFriend(user) {
    const friendContainer = document.getElementById('friends-container');
    const friendElement = document.createElement('div');
    friendElement.classList.add('friend');
    friendElement.textContent = user.username;
    friendContainer.appendChild(friendElement);
}

// Fetch users data when the page loads
fetchUsers();
</script>


